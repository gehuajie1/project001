<view class="chat-container">
  <!-- 聊天列表 -->
  <view class="chats-card card">
    <view class="card-header">
      <text class="title">我的聊天</text>
      <van-button size="small" type="primary" bind:click="showAddChat">新建聊天</van-button>
    </view>
    <view class="chats-list">
      <view class="chat-item" wx:for="{{chats}}" wx:key="id" bind:click="openChat" data-id="{{item.id}}">
        <image class="chat-avatar" src="{{item.avatar}}" mode="aspectFill" />
        <view class="chat-info">
          <view class="chat-header">
            <text class="chat-name">{{item.name}}</text>
            <text class="chat-time">{{item.lastTime}}</text>
          </view>
          <view class="chat-content">
            <text class="chat-message">{{item.lastMessage}}</text>
            <text class="chat-unread" wx:if="{{item.unread > 0}}">{{item.unread}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 新建聊天弹窗 -->
  <van-popup show="{{showAddChat}}" position="bottom" custom-style="height: 50%" bind:close="hideAddChat">
    <view class="popup-header">
      <text class="title">新建聊天</text>
      <van-icon name="cross" bind:click="hideAddChat" />
    </view>
    <view class="popup-content">
      <van-field
        label="聊天名称"
        placeholder="请输入聊天名称"
        value="{{chatForm.name}}"
        bind:change="onChatNameChange"
      />
      <van-field
        label="聊天描述"
        type="textarea"
        placeholder="请输入聊天描述"
        value="{{chatForm.description}}"
        bind:change="onChatDescriptionChange"
      />
      <view class="form-avatar">
        <text class="label">头像</text>
        <view class="avatar-upload" bind:click="chooseAvatar">
          <image wx:if="{{chatForm.avatar}}" src="{{chatForm.avatar}}" mode="aspectFill" />
          <van-icon wx:else name="plus" />
        </view>
      </view>
    </view>
    <view class="popup-footer">
      <van-button type="primary" block bind:click="submitChat">创建</van-button>
    </view>
  </van-popup>
</view> 